<!DOCTYPE html>
<html lang="en">
  <head>
    {% include "head.html" %}
  </head>
    <div id="map"></div>
    {% include "header.html" %}
    <div class="row divider" id="main">
      <div class="col-md-2 bg-light" onclick="OpenCloseMap()" style="opacity: 0.0"></div>
      <div class="col-md-8 bg-secondary main" height="100%">
        <div class="col-md-1"></div>
        <div class="col-md-12 bg-secondary" id="loadbasic">

        </div>
        <div class="col-md-1"></div>
      </div>
      <div class="col-md-2 bg-light" onclick="OpenCloseMap()" style="opacity: 0.0"></div>
		</div>
	</body>
  <script>
    var map, infoWindow, markerInd;
    function initMap() {
      infoWindow = new google.maps.InfoWindow;
      map = new google.maps.Map(document.getElementById('map'), {
        center: {lat: 30.057193, lng: 31.348490},
        zoom: 13,
        streetViewControl:false,
        fullscreenControl: false,
        mapTypeControlOptions: {
          position: google.maps.ControlPosition.LEFT_CENTER,
          style: google.maps.MapTypeControlStyle.DROPDOWN_MENU
        },
        styles: [
          {elementType: 'geometry', stylers: [{color: '#242f3e'}]},
          {elementType: 'labels.text.stroke', stylers: [{color: '#242f3e'}]},
          {elementType: 'labels.text.fill', stylers: [{color: '#746855'}]},
          {
            featureType: 'administrative.locality',
            elementType: 'labels.text.fill',
            stylers: [{color: '#d59563'}]
          },
          {
            featureType: 'poi',
            elementType: 'labels.text.fill',
            stylers: [{color: '#d59563'}]
          },
          {
            featureType: 'poi.park',
            elementType: 'geometry',
            stylers: [{color: '#4d8066'}]
          },
          {
            featureType: 'poi.park',
            elementType: 'labels.text.fill',
            stylers: [{color: '#6b9a76'}]
          },
          {
            featureType: 'road',
            elementType: 'geometry',
            stylers: [{color: '#38414e'}]
          },
          {
            featureType: 'road',
            elementType: 'geometry.stroke',
            stylers: [{color: '#212a37'}]
          },
          {
            featureType: 'road',
            elementType: 'labels.text.fill',
            stylers: [{color: '#9ca5b3'}]
          },
          {
            featureType: 'road.highway',
            elementType: 'geometry',
            stylers: [{color: '#746855'}]
          },
          {
            featureType: 'road.highway',
            elementType: 'geometry.stroke',
            stylers: [{color: '#1f2835'}]
          },
          {
            featureType: 'road.highway',
            elementType: 'labels.text.fill',
            stylers: [{color: '#f3d19c'}]
          },
          {
            featureType: 'transit',
            elementType: 'geometry',
            stylers: [{color: '#2f3948'}]
          },
          {
            featureType: 'transit.station',
            elementType: 'labels.text.fill',
            stylers: [{color: '#d59563'}]
          },
          {
            featureType: 'water',
            elementType: 'geometry',
            stylers: [{color: '#17263c'}]
          },
          {
            featureType: 'water',
            elementType: 'labels.text.fill',
            stylers: [{color: '#515c6d'}]
          },
          {
            featureType: 'water',
            elementType: 'labels.text.stroke',
            stylers: [{color: '#17263c'}]
          }
        ]
      });
      map.addListener('click', function(e) {
        marker = placeMarkerAndPanTo(e.latLng, map);
        markerInd++;
        var infowindow = new google.maps.InfoWindow({
          content: '<button type="button" class="btn btn-info" onclick="createEv('+markerInd+')">Create Event</button>',
          marker:marker,
        });

        infowindow.open(map, marker);
        google.maps.event.addListener(infowindow,'closeclick',function(){
           infowindow.marker.setMap(null);
        });
      });

      if (navigator.geolocation) {
          navigator.geolocation.getCurrentPosition(function(position) {
            var pos = {
              lat: position.coords.latitude,
              lng: position.coords.longitude
            };

            infoWindow.setPosition(pos);
            infoWindow.setContent('Location found.');
            infoWindow.open(map);
            map.setCenter(pos);
          }, function() {
            handleLocationError(true, infoWindow, map.getCenter());
          });
        } else {
          // Browser doesn't support Geolocation
          handleLocationError(false, infoWindow, map.getCenter());
        }
        function toggleStreetView() {
          var toggle = panorama.getVisible();
          if (toggle == false) {
            panorama.setVisible(true);
          } else {
            panorama.setVisible(false);
          }
        }
    }

    function placeMarkerAndPanTo(latLng, map) {
      var marker = new google.maps.Marker({
        position: latLng,
        map: map
      });

      map.panTo(latLng);
      return marker;
    }

    $(window).bind("load", function() {
      document.getElementById("map").style.position = 'fixed';
    });

    function OpenCloseMap(){
      if($("#main").css("display")=="none"){
        $("#main").css("display","flex");
      }
      else{
        $("#main").css("display","none");
      }
    }

    $(".nav-link").click(function(){
      if($("#main").css("display")=="none"){
        $("#main").css("display","flex");
      }
    });

    $(".btn").click(function(){
      if($(this).parent().parent().parent().hasClass('navbar')){
        if($("#main").css("display")=="none"){
          $("#main").css("display","flex");
        }
      }
    });

    var curPage = "/index/";
    $("#loadbasic").load("/index/");

    $(document).ready(function(){
      var myIndex = 0;
      var curPage = "/index/";
      $("#loadbasic").load("/index/");
      carousel();
      function carousel() {
          if(curPage=="/index/"){
          var i;
          var x = document.getElementsByClassName("mySlides");
          for (i = 0; i < x.length; i++) {
             x[i].style.display = "none";
          }
          myIndex++;
          if (myIndex >= x.length) {myIndex = 0}
          if(x.length>0) x[myIndex].style.display = "block";
  }
  setTimeout(carousel, 2000);
      }

      // Used to toggle the menu on small screens when clicking on the menu button
      function myFunction() {
          var x = document.getElementById("navDemo");
          if (x.className.indexOf("w3-show") == -1) {
              x.className += " w3-show";
          } else {
              x.className = x.className.replace(" w3-show", "");
          }
      }

      // When the user clicks anywhere outside of the modal, close it
      var modal = document.getElementById('ticketModal');
      window.onclick = function(event) {
        if (event.target == modal) {
          modal.style.display = "none";
        }
      }

      $("#index").click(function(){
        if (curPage != "/index/"){
          curPage = "/index/";
          $("#loadbasic").load("/index/");
        }
      });

      $("#Register").click(function(){
        if (curPage != "/signup/"){
          curPage = "/signup/";
          $("#loadbasic").load("/signup/");
        }
      });

      $("#evCreate").click(function(){
        if (curPage != "/EventCreate/"){
          curPage = "/EventCreate/";
          $("#loadbasic").load(curPage);
        }
      });

      $("#login").click(function(){
        if (curPage != "/login/"){
          if ($('#loginBut').text() != "Logout"){
            curPage = "/login/";
            $("#loadbasic").load("/login/");
          }
          else{
            $("#loadbasic").load("/login/");
            setTimeout(function(){
               window.location.reload(1);
            }, 500);
          }
        }

      });
      $("#myRes").click(function(){
        if (curPage != "/myReservations/"){
          curPage = "/myReservations/";
          $.ajax({
              url: '/myReservations/'/*+ $(this).parent().attr('id')*/,
              type: 'GET',
              success: function(result) {
                $("#loadbasic").html(result)
                alert("pass");
                $(".deleteRes").click(function(){
                  var elem = $(this).parent().parent().attr('id');
                  alert(elem);
                  $("#"+elem).remove();
                  $.ajax({
                      url: '/deleteRes/' + elem + '/',
                      type: 'DELETE',
                      headers: {'X-CSRFToken':'{{ csrf_token }}'},
                      success: function(result) {
                          $("#"+elem).remove();
                      }
                  });
                });
              }
          });
        }
      });
      $("#myEv").click(function(){
        if (curPage != "/myEvents/"){
          curPage = "/myEvents/";
          $.ajax({
              url: '/myEvents/'/*+ $(this).parent().attr('id')*/,
              type: 'GET',
              success: function(result) {
                $("#loadbasic").html(result)
                alert("pass");
                $(".deleteEv").click(function(){
                  var elem = $(this).parent().parent().attr('id');
                  alert(elem);
                  $("#"+elem).remove();
                  $.ajax({
                      url: '/deleteEv/' + elem + '/',
                      type: 'DELETE',
                      headers: {'X-CSRFToken':'{{ csrf_token }}'},
                      success: function(result) {
                          $("#"+elem).remove();
                      }
                  });
                });
              }
          });
        }
      });
    });

    /*
    infoWindow = new google.maps.InfoWindow;
      if (navigator.geolocation) {
          navigator.geolocation.getCurrentPosition(function(position) {
            var pos = {
              lat: position.coords.latitude,
              lng: position.coords.longitude
            };

            infoWindow.setPosition(pos);
            infoWindow.setContent('Location found.');
            infoWindow.open(map);
            map.setCenter(pos);
          }, function() {
            handleLocationError(true, infoWindow, map.getCenter());
          });
        } else {
          // Browser doesn't support Geolocation
          handleLocationError(false, infoWindow, map.getCenter());
        }

      function handleLocationError(browserHasGeolocation, infoWindow, pos) {
        infoWindow.setPosition(pos);
        infoWindow.setContent(browserHasGeolocation ?
                              'Error: The Geolocation service failed.' :
                              'Error: Your browser doesn\'t support geolocation.');
        infoWindow.open(map);
      }
    }


    $(window).bind("load", function() {
      document.getElementById("map").style.position = 'fixed';
    });

    function OpenCloseMap(){
      if($("#main").css("display")=="none"){
        $("#main").css("display","flex");
      }
      else{
        $("#main").css("display","none");
      }
    }

    $(document).ready(function(){
      var myIndex = 0;
      var curPage = "/index/";
      $("#loadbasic").load("/index/");
      carousel();
      function carousel() {
          if(curPage=="/index/"){
          var i;
          var x = document.getElementsByClassName("mySlides");
          for (i = 0; i < x.length; i++) {
             x[i].style.display = "none";
          }
          myIndex++;
          if (myIndex >= x.length) {myIndex = 0}
          if(x.length>0) x[myIndex].style.display = "block";
	}
	setTimeout(carousel, 2000);
      }

      // Used to toggle the menu on small screens when clicking on the menu button
      function myFunction() {
          var x = document.getElementById("navDemo");
          if (x.className.indexOf("w3-show") == -1) {
              x.className += " w3-show";
          } else {
              x.className = x.className.replace(" w3-show", "");
          }
      }

      // When the user clicks anywhere outside of the modal, close it
      var modal = document.getElementById('ticketModal');
      window.onclick = function(event) {
        if (event.target == modal) {
          modal.style.display = "none";
        }
      }

      $("#index").click(function(){
        if (curPage != "/index/"){
          curPage = "/index/";
          $("#loadbasic").load("/index/");
        }
      });
      $("#login").click(function(){
        if (curPage != "/login/"){
          curPage = "/login/";
          $("#loadbasic").load("/login/");
        }
      });
    });
    */

  </script>
  <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyA5BEaYPvpke0l_9Fc8ddAe2OmxQmxAp8g&callback=initMap"
  async defer></script>
</html>
